<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>The Complete FASM Programming Book</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/ebook.css">
    <link rel="stylesheet" href="styles/eink.css">
    <link rel="stylesheet" href="styles/accessibility.css">
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="manifest" href="manifest.json">
</head>
<body class="eink-mode">
    <!-- Skip Links for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <a href="#navigation-panel" class="skip-link">Skip to navigation</a>
    <a href="#ai-toggle" class="skip-link">Skip to AI assistant</a>
    
    <!-- ARIA Live Region for Announcements -->
    <div id="sr-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    
    <!-- Navigation Panel -->
    <nav id="navigation-panel" class="nav-panel" role="navigation" aria-label="Book navigation">
        <div class="nav-header">
            <h1 id="book-title">FASM Programming Book</h1>
            <button id="nav-toggle" class="nav-toggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="nav-content">☰</button>
        </div>
        
        <div id="nav-content" class="nav-content" aria-labelledby="book-title">
            <!-- Table of Contents -->
            <div class="toc-section">
                <h3>Table of Contents</h3>
                <ul id="toc-list" class="toc-list">
                    <!-- Will be populated by JavaScript -->
                </ul>
            </div>
            
            <!-- Reading Progress -->
            <div class="progress-section" role="region" aria-labelledby="progress-heading">
                <h3 id="progress-heading">Reading Progress</h3>
                <div class="progress-bar" role="progressbar" aria-labelledby="progress-heading" aria-describedby="progress-text">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <span id="progress-text">0% Complete</span>
            </div>
            
            <!-- Bookmarks -->
            <div class="bookmarks-section" role="region" aria-labelledby="bookmarks-heading">
                <h3 id="bookmarks-heading">Bookmarks</h3>
                <ul id="bookmarks-list" class="bookmarks-list" aria-labelledby="bookmarks-heading">
                    <!-- Will be populated by JavaScript -->
                </ul>
            </div>
            
            <!-- Reading History -->
            <div class="history-section" role="region" aria-labelledby="history-heading">
                <h3 id="history-heading">Recent Reading</h3>
                <ul id="history-list" class="history-list" aria-labelledby="history-heading">
                    <!-- Will be populated by JavaScript -->
                </ul>
            </div>
            
            <!-- Instruction Glossary -->
            <div class="glossary-section">
                <h3>Instruction Reference</h3>
                <div class="glossary-search">
                    <label for="glossary-search" class="sr-only">Search instructions</label>
                    <input type="text" id="glossary-search" placeholder="Search instructions..." 
                           onkeyup="searchInstructions(this.value)" 
                           aria-label="Search instruction reference">
                </div>
                <ul id="glossary-list" class="glossary-list">
                    <!-- Will be populated by JavaScript -->
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- Main Content Area -->
    <main id="main-content" class="main-content" role="main" aria-labelledby="chapter-title">
        <!-- Chapter Navigation -->
        <nav class="chapter-nav" role="navigation" aria-label="Chapter navigation">
            <button id="prev-chapter" class="nav-btn" aria-label="Go to previous chapter">← Previous</button>
            <span id="chapter-info" class="chapter-info" aria-live="polite">Loading...</span>
            <button id="next-chapter" class="nav-btn" aria-label="Go to next chapter">Next →</button>
        </nav>
        
        <!-- Content Display -->
        <article id="chapter-content" class="chapter-content" role="article" aria-labelledby="chapter-title">
            <!-- Initial loading content -->
            <div class="initial-loading" aria-live="polite">
                <h2 id="chapter-title">▣ FASM Programming eBook</h2>
                <p>Loading the complete assembly programming guide...</p>
                <div style="margin: 20px 0;" role="progressbar" aria-label="Loading progress">
                    <div style="width: 100%; background: #e0e0e0; height: 4px; border-radius: 2px;">
                        <div style="width: 0%; background: #666666; height: 100%; border-radius: 2px; animation: loadingBar 2s ease-in-out infinite;"></div>
                    </div>
                </div>
                <p><small>This may take a moment on first load...</small></p>
            </div>
        </article>
        
        <!-- Page Navigation -->
        <nav class="page-nav" role="navigation" aria-label="Page navigation">
            <button id="prev-page" class="page-btn" aria-label="Go to previous page">← Previous Page</button>
            <span id="page-info" class="page-info" aria-live="polite">Page 1 of 1</span>
            <button id="next-page" class="page-btn" aria-label="Go to next page">Next Page →</button>
        </nav>
    </main>
    
    <!-- Drawing Canvas Overlay (for eInk devices) -->
    <canvas id="drawing-canvas" class="drawing-canvas"></canvas>
    
    <!-- Control Icons Container -->
    <div id="control-icons" class="control-icons">
        <!-- Settings Panel -->
        <div id="settings-panel" class="settings-panel">
            <button id="settings-toggle" class="settings-toggle" 
                    title="Settings" 
                    aria-label="Open reading settings">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="m12 1 1.73 1v3.52a8.97 8.97 0 0 1 2.24.68l2.49-2.49L19.73 5l-2.49 2.49a8.97 8.97 0 0 1 .68 2.24H21v2.46h-3.52a8.97 8.97 0 0 1-.68 2.24l2.49 2.49L18 19.73l-2.49-2.49a8.97 8.97 0 0 1-2.24.68V21h-2.46v-3.52a8.97 8.97 0 0 1-2.24-.68L5.27 19.73 4 18.46l2.49-2.49a8.97 8.97 0 0 1-.68-2.24H2v-2.46h3.52a8.97 8.97 0 0 1 .68-2.24L3.73 5.27 5 4l2.49 2.49A8.97 8.97 0 0 1 9.73 5.5V2h2.46z"></path>
                </svg>
            </button>
            <div class="settings-content">
                <div class="settings-header">
                    <h3>Reading Settings</h3>
                    <button class="settings-close">×</button>
                </div>
                <div class="settings-body">
                    <div class="setting-group">
                        <label for="display-mode">Display Mode:</label>
                        <select id="display-mode">
                            <option value="eink">eInk Friendly</option>
                            <option value="standard">Standard</option>
                            <option value="dark">Dark Mode</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label for="font-size">Font Size:</label>
                        <input type="range" id="font-size" min="12" max="24" value="16" aria-describedby="font-size-value">
                        <span id="font-size-value">16px</span>
                    </div>
                    
                    <div class="setting-group">
                        <label for="line-height">Line Height:</label>
                        <input type="range" id="line-height" min="1.2" max="2.0" step="0.1" value="1.6" aria-describedby="line-height-value">
                        <span id="line-height-value">1.6</span>
                    </div>
                    
                    <div class="setting-group">
                        <label for="drawing-mode">
                            <input type="checkbox" id="drawing-mode"> Drawing Mode
                        </label>
                        <span class="setting-description">Enable drawing annotations</span>
                    </div>
                    
                    <div class="setting-group">
                        <label for="zen-mode">
                            <input type="checkbox" id="zen-mode"> Zen Mode
                        </label>
                        <span class="setting-description">Hide UI controls for distraction-free reading</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Helper -->
        <div id="ai-helper" class="ai-helper">
            <button id="ai-toggle" class="ai-toggle" 
                    aria-label="Open AI Programming Assistant" 
                    aria-expanded="false" 
                    aria-controls="ai-window"
                    title="AI Assistant - Click to open or drag to move">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M12 8V4H8"></path>
                    <rect width="16" height="12" x="4" y="8" rx="2"></rect>
                    <path d="m2 14 2-2 4 4"></path>
                    <path d="m20 10-2 2-4-4"></path>
                    <path d="m9 15 3-3 3 3"></path>
                </svg>
            </button>
            <div id="ai-window" class="ai-window" 
                 role="dialog" 
                 aria-modal="true" 
                 aria-labelledby="ai-title"
                 aria-describedby="ai-description">
                <div class="ai-header" data-drag-handle aria-label="Drag to move window">
                    <h3 id="ai-title">FASM Programming Assistant</h3>
                    <button id="ai-close" class="ai-close" 
                            aria-label="Close AI Assistant">×</button>
                </div>
                <div class="ai-content">
                    <div id="ai-description" class="sr-only">AI assistant for FASM programming help and guidance</div>
                    <div id="ai-chat" class="ai-chat" 
                         role="log" 
                         aria-live="polite" 
                         aria-label="Conversation with AI assistant">
                        <div class="ai-message">
                            <strong>Assistant:</strong> Hello! I'm your FASM programming assistant. I can help explain concepts, debug code, suggest optimizations, and answer questions about assembly programming. What would you like to know?
                        </div>
                    </div>
                    <div class="ai-input" role="form" aria-label="Send message to AI assistant">
                        <label for="ai-input-field" class="sr-only">Ask the AI assistant a question</label>
                        <input type="text" 
                               id="ai-input-field" 
                               aria-label="Type your question for the AI assistant"
                               aria-describedby="ai-input-help"
                               placeholder="Ask me anything about FASM or assembly programming...">
                        <div id="ai-input-help" class="sr-only">Press Enter to send or use the Send button</div>
                        <button id="ai-send" class="ai-send" 
                                aria-label="Send message to AI assistant">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="js/config.js"></script>
    <script src="js/drag-utility.js"></script>
    <script src="js/dom-cache.js"></script>
    <script src="js/dynamic-glossary.js"></script>
    <script src="js/instruction-glossary.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/markdown-parser.js"></script>
    <script src="js/markdown.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/drawing.js"></script>
    <script src="js/ai-helper.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/main.js"></script>
</body>
</html>